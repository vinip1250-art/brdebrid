<!DOCTYPE html>
<html>
<head>
    <title>Configurar Meu Brazuca Mod</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: #111; color: #eee; }
        input, select { width: 100%; padding: 10px; margin: 10px 0; background: #222; color: #fff; border: 1px solid #444; }
        button { background: #6f42c1; color: white; padding: 15px; border: none; width: 100%; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .section { background: #1a1a1a; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>Configuração do Addon</h1>
    
    <div class="section">
        <h3>1. Provedor de Debrid</h3>
        <select id="debrid_service">
            <option value="torbox">Torbox</option>
            <option value="realdebrid">Real Debrid</option>
        </select>
        <input type="text" id="debrid_apikey" placeholder="Sua API Key do Debrid">
    </div>

    <div class="section">
        <h3>2. Jackett (Opcional)</h3>
        <p>Use seu próprio indexador para achar mais conteúdos.</p>
        <input type="text" id="jackett_url" placeholder="URL do Jackett (ex: http://meu-ip:9117)">
        <input type="text" id="jackett_key" placeholder="API Key do Jackett">
    </div>

    <button onclick="install()">Instalar no Stremio</button>

    <div class="section" id="link-section" style="display: none; margin-top: 20px;">
        <h3>3. Link do Manifest (Para cópia manual)</h3>
        <input type="text" id="manifest_link" readonly placeholder="Gere o link acima">
        <button onclick="copyLink()">Copiar Link</button>
    </div>

    <script>
        function install() {
            // 1. Coletar Configurações
            const config = {
                service: document.getElementById('debrid_service').value,
                debrid_key: document.getElementById('debrid_apikey').value.trim(),
                jackett_url: document.getElementById('jackett_url').value.trim(),
                jackett_key: document.getElementById('jackett_key').value.trim()
            };

            // Validação simples
            if (!config.debrid_key) {
                alert("Por favor, insira a API Key do seu Provedor de Debrid.");
                return;
            }

            // 2. Codificar para Base64
            const jsonConfig = JSON.stringify(config);
            const b64Config = btoa(jsonConfig); 

            const host = window.location.host;
            const fullManifestURL = `https://${host}/${b64Config}/manifest.json`;
            const installLink = `stremio://service/${host}/${b64Config}/manifest.json`;

            // 3. Exibir o link para cópia manual
            document.getElementById('manifest_link').value = fullManifestURL;
            document.getElementById('link-section').style.display = 'block';

            // 4. Tentar a instalação automática
            window.location.href = installLink;
        }

        function copyLink() {
            const linkField = document.getElementById('manifest_link');
            
            // Método moderno de cópia
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(linkField.value).then(() => {
                    alert("Link do Manifest copiado para a área de transferência!");
                }).catch(err => {
                    // Fallback se houver erro
                    fallbackCopy(linkField);
                });
            } else {
                // Fallback para navegadores mais antigos
                fallbackCopy(linkField);
            }
        }

        function fallbackCopy(linkField) {
            linkField.select(); 
            linkField.setSelectionRange(0, 99999); 
            try {
                document.execCommand("copy"); 
                alert("Link do Manifest copiado para a área de transferência!");
            } catch (err) {
                alert("Erro ao copiar o link. Por favor, copie manualmente.");
            }
        }
    </script>
</body>
</html>
